# Flask 練習問題

Flaskのクイックスタートで学んだ内容を確認するための練習問題です。
段階的に難易度が上がるように構成されています。

## 問題1: 基本的なルーティングと変数ルール

**要件:**
- `/hello/<name>` というルートを作成
- 名前を受け取り、「こんにちは、{name}さん！」と表示
- 名前が指定されていない場合は「こんにちは、ゲストさん！」と表示
- HTMLエスケープを忘れずに実装

**ヒント:** `@app.route()` デコレータと `escape()` 関数を使用

---

## 問題2: HTTPメソッドの使い分け

**要件:**
- `/calculator` というルートを作成
- GETリクエスト: 計算フォームを表示（HTMLフォーム）
- POSTリクエスト: 2つの数値と演算子（+, -, *, /）を受け取り、計算結果を表示
- エラーハンドリング: ゼロ除算の場合は適切なエラーメッセージを表示

**ヒント:** `request.method` と `request.form` を使用

---

## 問題3: テンプレートを使った一覧表示

**要件:**
- `/products` というルートを作成
- 商品リスト（辞書のリスト）をテンプレートに渡して表示
- 商品情報: id, name, price, description
- テンプレートファイル: `products.html` を作成
- 各商品をクリックすると `/product/<id>` に遷移

**商品データ例:**
```python
products = [
    {"id": 1, "name": "ノートPC", "price": 89800, "description": "高性能なノートパソコン"},
    {"id": 2, "name": "マウス", "price": 1980, "description": "ワイヤレスマウス"},
    {"id": 3, "name": "キーボード", "price": 3980, "description": "メカニカルキーボード"},
]
```

**ヒント:** `render_template()` と Jinja2 テンプレート構文を使用

---

## 問題4: セッションを使ったログイン機能

**要件:**
- `/login` ルートを作成（GET/POST両対応）
- GET: ログインフォームを表示
- POST: ユーザー名とパスワードをチェック
  - 正しい場合: セッションにユーザー名を保存し、`/dashboard` にリダイレクト
  - 間違っている場合: エラーメッセージを表示
- `/dashboard` ルートを作成
  - セッションにユーザー名がある場合: 「ようこそ、{username}さん！」と表示
  - セッションにユーザー名がない場合: `/login` にリダイレクト
- `/logout` ルートを作成
  - セッションをクリアして `/login` にリダイレクト

**認証情報（簡易版）:**
```python
# 実際のアプリではデータベースを使いますが、練習用に固定値
VALID_USERNAME = "admin"
VALID_PASSWORD = "password123"
```

**ヒント:** `session`, `redirect()`, `url_for()` を使用

---

## 問題5: JSON API エンドポイント

**要件:**
- `/api/users` というルートを作成
- ユーザーリストをJSON形式で返す
- `/api/users/<int:user_id>` というルートを作成
- 指定されたIDのユーザー情報をJSON形式で返す
- ユーザーが見つからない場合は404エラーを返す

**ユーザーデータ例:**
```python
users = [
    {"id": 1, "name": "山田太郎", "email": "yamada@example.com", "age": 25},
    {"id": 2, "name": "佐藤花子", "email": "sato@example.com", "age": 30},
    {"id": 3, "name": "鈴木一郎", "email": "suzuki@example.com", "age": 28},
]
```

**ヒント:** 辞書やリストを返すと自動的にJSONに変換されます。`abort(404)` でエラーを返せます。

---

## 問題6: ファイルアップロード機能

**要件:**
- `/upload` というルートを作成（GET/POST両対応）
- GET: ファイルアップロードフォームを表示
- POST: アップロードされた画像ファイルを受け取り
  - `uploads/` フォルダに保存
  - ファイル名は `secure_filename()` を使用して安全に処理
  - アップロード成功後、アップロードされた画像を表示するページにリダイレクト
- `/uploaded/<filename>` というルートを作成
  - アップロードされた画像を表示

**ヒント:** `request.files`, `secure_filename()`, `redirect()` を使用

---

## 問題7: メッセージフラッシング

**要件:**
- 問題4のログイン機能を拡張
- ログイン成功時に「ログインに成功しました」というフラッシュメッセージを表示
- ログアウト時に「ログアウトしました」というフラッシュメッセージを表示
- ダッシュボードでフラッシュメッセージを表示

**ヒント:** `flash()`, `get_flashed_messages()` を使用

---

## 問題8: エラーハンドリング

**要件:**
- 404エラー用のカスタムエラーページを作成
- 500エラー用のカスタムエラーページを作成
- エラーページには適切なメッセージと、トップページへのリンクを表示

**ヒント:** `@app.errorhandler()` デコレータを使用

---

## 問題9: URL構築とリダイレクト

**要件:**
- `/old-page` にアクセスした場合、`/new-page` にリダイレクト
- `/new-page` では「ページが移動しました」というメッセージを表示
- リダイレクトには `url_for()` を使用

**ヒント:** `redirect()`, `url_for()` を使用

---

## 問題10: 総合問題 - シンプルなブログシステム

**要件:**
以下の機能を持つシンプルなブログシステムを作成してください：

1. **トップページ (`/`)**
   - 最新5件のブログ投稿を一覧表示
   - 各投稿のタイトル、投稿日時、概要を表示

2. **投稿詳細ページ (`/post/<int:post_id>`)**
   - 指定されたIDの投稿の詳細を表示
   - タイトル、本文、投稿日時を表示
   - 投稿が見つからない場合は404エラー

3. **新規投稿作成 (`/post/new`)**
   - GET: 投稿フォームを表示
   - POST: フォームデータを受け取り、新しい投稿を作成
   - 成功後、作成した投稿の詳細ページにリダイレクト
   - フラッシュメッセージで成功を通知

4. **セッション管理**
   - ログイン機能（問題4を参考）
   - ログインしているユーザーのみが投稿を作成できる
   - 未ログインのユーザーが `/post/new` にアクセスした場合、ログインページにリダイレクト

**データ構造:**
```python
# メモリ上に保存（実際のアプリではデータベースを使用）
posts = []
next_id = 1
```

**投稿データ構造:**
```python
{
    "id": 1,
    "title": "投稿タイトル",
    "content": "投稿本文",
    "author": "投稿者名",
    "created_at": "2024-01-01 12:00:00"
}
```

---

## 解答例の作成方法

各問題を `exercise_01.py`, `exercise_02.py` のように別ファイルで作成するか、
すべてを統合した `blog_app.py` を作成してください。

テンプレートファイルは `templates/` フォルダに配置してください。

## 確認ポイント

各問題を解いた後、以下を確認してください：

- [ ] コードが正しく動作するか
- [ ] HTMLエスケープが適切に行われているか
- [ ] エラーハンドリングが適切か
- [ ] セキュリティを考慮しているか（ファイルアップロード、セッションなど）
- [ ] コードが読みやすく、保守しやすいか

頑張ってください！🚀
